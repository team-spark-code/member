<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Member List</title>
    <style>
        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
        }
        .search-btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
        }
        .search-btn:hover {
            background: #0056b3;
        }
        .sync-btn {
            padding: 6px 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }
        .sync-btn:hover {
            background: #1e7e34;
        }
        .clear-btn {
            padding: 6px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 4px;
        }
        .clear-btn:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
<div style="max-width:800px;margin:40px auto;padding:24px;border:1px solid #eee;border-radius:8px;box-shadow:0 2px 8px #eee;">
<h2 style="text-align:center;">회원 목록</h2>

<!-- 검색 폼 -->
<div class="search-container">
    <form method="get" action="/members">
        <div style="margin-bottom: 10px;">
            <input type="text" name="keyword" class="search-input"
                   th:value="${keyword}" placeholder="이름, 아이디, 이메일, 주소로 검색...">
            <button type="submit" class="search-btn">검색</button>
            <a href="/members" class="clear-btn" style="text-decoration:none;display:inline-block;">전체보기</a>
            <button type="button" class="sync-btn" onclick="syncToElasticsearch()">ES 동기화</button>
        </div>

        <!-- 검색 모드 선택 -->
        <div style="margin-bottom: 10px;">
            <label style="font-size: 12px; color: #666;">검색 모드:</label>
            <select name="searchMode" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; margin-left: 5px;">
                <option value="standard" th:selected="${searchMode == 'standard'}">표준 검색 (연관도 기반)</option>
                <option value="exact" th:selected="${searchMode == 'exact'}">정확한 매칭 (높은 정확도)</option>
                <option value="fuzzy" th:selected="${searchMode == 'fuzzy'}">유사 검색 (오타 허용)</option>
            </select>
            <span style="font-size: 11px; color: #999; margin-left: 10px;">
                💡 표준: 연관도순 정렬 | 정확: 완전일치 우선 | 유사: 오타 허용
            </span>
        </div>
    </form>

    <div th:if="${keyword != null and !#strings.isEmpty(keyword)}" style="margin-top:8px;font-size:14px;color:#666;">
        검색어: "<span th:text="${keyword}"></span>"
        <span th:if="${searchMode != null and searchMode != 'standard'}" style="color: #007bff;">
            (모드: <span th:text="${searchMode == 'exact' ? '정확한 매칭' : (searchMode == 'fuzzy' ? '유사 검색' : '표준 검색')}"></span>)
        </span>
    </div>
</div>

<table style="width:100%;border-collapse:collapse;margin-bottom:16px;">
    <thead>
    <tr style="background:#f8f8f8;">
        <th style="padding:8px;border-bottom:1px solid #ddd;">ID</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">아이디</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">이름</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">이메일</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">주소</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="member : ${members}">
        <td th:text="${member.id}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.username}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.name}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.email}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.address}" style="padding:8px;border-bottom:1px solid #eee;"></td>
    </tr>
    </tbody>
</table>

<!-- 검색 결과가 없을 때 -->
<div th:if="${#lists.isEmpty(members)}" style="text-align:center;padding:20px;color:#666;">
    <div th:if="${keyword != null and !#strings.isEmpty(keyword)}">
        검색 결과가 없습니다.
    </div>
    <div th:unless="${keyword != null and !#strings.isEmpty(keyword)}">
        등록된 회원이 없습니다.
    </div>
</div>

<!-- 페이지네이션 -->
<div style="text-align:center;margin-bottom:12px;" th:if="${!#lists.isEmpty(members)}">
    <span th:if="${hasPrev}">
        <a th:href="@{'/members'(page=${currentPage - 1}, keyword=${keyword})}" style="margin:0 8px;">이전</a>
    </span>
    <span> Page <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span> </span>
    <span th:if="${hasNext}">
        <a th:href="@{'/members'(page=${currentPage + 1}, keyword=${keyword})}" style="margin:0 8px;">다음</a>
    </span>
</div>

<p style="text-align:center;"><a href="/">메인으로 돌아가기</a></p>
</div>

<script>
function syncToElasticsearch() {
    if (!confirm('엘라스틱서치에 회원 데이터를 동기화하시겠습니까?')) {
        return;
    }

    fetch('/members/sync', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert(data.message);
        } else {
            alert('오류: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('동기화 중 오류가 발생했습니다.');
    });
}

// 엔터키로 검색 실행
document.querySelector('.search-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.target.closest('form').submit();
    }
});
</script>
</body>
</html>
